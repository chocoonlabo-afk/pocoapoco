📘 DEVELOPMENT_RULES.md

pocoapoco／次回アプリ開発用：完全ルール集（現状版）


------------------------------------------------------------
# 1. プロジェクト全体方針
------------------------------------------------------------

●重複を減らし、ファイル肥大化を防ぐ  
●キー名・URL・参照先の揺れをなくす  
●CSV／i18n／localStorage の仕様を明確化  
●テストデータをいつでも復元できるように  
●ChatGPTとのやり取りを“安全化”し、勝手なキー増殖を防ぐ


------------------------------------------------------------
# 2. 画面構成・フォルダ構造
------------------------------------------------------------

別途、Pocoapocoキー一覧.xlsx 参照  
（※Excel は設計ドキュメント。実際のコード上の「正」は constants.js と一致させる）


------------------------------------------------------------
# 3. 共通 UI・スタイルルール
------------------------------------------------------------

◆ 将来的には、layout + globals.css で一括管理する方針。  
　現在は各 page.js 内にべた書きされており、無理に共通化すると壊すリスクが高いため「現状維持」。  

　背景色： `background: var(--pap-bg);` を基本とする。

◆ 共通UIコンポーネント  
　（将来のPocoPractice等ではコンポーネント化するが、現行pocoapocoでは大きな改造はしない）


------------------------------------------------------------
# 4. キー・参照先・ルーティングのルール
------------------------------------------------------------

◆ すべての定数は `constants.js` で管理する

- 環境変数：`SUPABASE_URL` / `SUPABASE_ANON_KEY` など  
- localStorage キー：`LS_CHILDREN` / `LS_HISTORY` / `LS_SONGS` など  
- アプリ内ルート：`ROUTE_HOME` / `ROUTE_RECORD` / `ROUTE_CALENDAR` など  
- 外部URL（ポータル側）：`PORTAL_LOGIN_URL` / `PORTAL_BUY_URL` など  

◆ 画面側では文字列リテラル禁止

- `"pocopoco_children"` や `"/record"` のような文字列は直接書かない  
- 必ず `constants.js` の定数（`LS_***`, `ROUTE_***`, `PORTAL_***` 等）を import して使う  

◆ Excel との関係

- Pocoapocoキー一覧.xlsx は「一覧・説明用」  
- 実装の基準は **必ず constants.js 側** とし、差異があれば Excel を追従させる


------------------------------------------------------------
# 5. i18n（言語系）ルール
------------------------------------------------------------

◆ i18nキーの命名形式

- `screen.home.title`  
- `screen.record.startButton`  
- `calendar.badge.silver`  など

◆ 文言の追加は必ず i18n ファイルで行う

- JSX 内で `"ホーム"` のような直接書きは禁止  
- `i18n.t('screen.home.title')` の形式で呼び出す


------------------------------------------------------------
# 6. CSV入出力ルール
------------------------------------------------------------

◆ 文字コード

- UTF-8（BOM付き）  
- 改行コードは CRLF (`\r\n`)  
→ Excel の文字化け防止を最優先とする

◆ ヘッダーチェック

- `csvHeaders.js` に「正しいヘッダー配列」を固定で定義  
- 読み込んだCSVの1行目と完全一致しなければエラー扱い（読み込み中断）

◆ インポート挙動

- 差分追加は禁止  
- 正しい形式なら **既存データを完全上書き**  
- 間違ったヘッダーの場合は警告メッセージを表示して中断


------------------------------------------------------------
# 7. テストデータ（開発効率のための仕組み）
------------------------------------------------------------

◆ `devSeeds.js` にテストデータを定義する想定

例：

```js
export const devSeeds = {
  pocopoco_children: [...],
  pocopoco_songs: [...],
  pocopoco_history: [...],
};


------------------------------------------------------------

\# 8. チャットGPTとの開発ルール

------------------------------------------------------------

◆ 各スレッド冒頭で貼るテンプレ

●一緒にアップロード／貼り付けるファイル

DEVELOPMENT_RULES.md（このファイル）

Pocoapocoキー一覧.xlsx（あれば）

constants.js（最新版）

●文章テンプレ

【スレッドの目的、ゴール】
（例）「カレンダー画面のバグ修正と、バッジ表示の追加」

【変更してはいけないもの】

localStorage キー（constants.js の LS_***）

アプリ内ルート（constants.js の ROUTE_***）

外部URL（constants.js の PORTAL_***）

i18n キーの命名ルール

UIの基調デザイン（紫系・system-ui・角丸12px）

【新しいキーやURLを使う場合】

必ず constants.js に定数を追加するコードも同時に出してもらう

画面側に文字列リテラルを書かない（LS_***, ROUTE_*** を使う）

既存のキー名・URL名を勝手に変更しない

【コードの出し方】

「置き換え版で」と依頼した場合は、必ず ファイル全体のコード を返してもらう

デザインを変えないこと（背景色・フォント・角丸など）

既存機能の削除は禁止。追加や修正だけを行うこと。


------------------------------------------------------------

\# 9. 開発開始時のルール

------------------------------------------------------------


1.まず「全体像まとめスレッド」を立てる

　基本的な仕様

　画面構成・ファイル構造
　
　利用する共通ルール（このMD、constants.js など）

2.その後、画面や機能ごとにスレッドを分ける

　例：ホーム画面、記録画面、履歴画面、カレンダー画面、設定画面 など

　各スレッドの冒頭に「目的・ゴール」と「変更禁止事項」を必ず書く

3.既存コードを送るときのルール

　必ず「最新版のみ」を送る

　差分ではなく、丸ごとのファイルを渡す

　constants.js を変えた場合は、その内容も同時に送る

4.ChatGPT による修正後は

　まずローカルで軽く動作確認（致命的エラーがないか）

　その後、テストシナリオ（別途Excel）に沿って検証する
