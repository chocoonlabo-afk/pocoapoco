"use client";

import { useState, useEffect, useRef } from "react";

// ---------- å®šæ•°ãƒ»åˆæœŸã‚¿ã‚¹ã‚¯ã‚»ãƒƒãƒˆ ----------

const DEFAULT_TASKS = [
  { label: "ãƒã‚¤ã‚ªãƒªãƒ³", icon: "ğŸ»" },
  { label: "ãƒ”ã‚¢ãƒ", icon: "ğŸ¹" },
  { label: "ã‚½ãƒ«ãƒ•ã‚§ãƒ¼ã‚¸ãƒ¥", icon: "ğŸ“" },
  { label: "å›½èª", icon: "ğŸ“–" },
  { label: "ç®—æ•°", icon: "ğŸ”¢" },
  { label: "è‹±èª", icon: "ğŸ‡¬ğŸ‡§" },
  { label: "ç†ç§‘", icon: "ğŸ”¬" },
  { label: "ç¤¾ä¼š", icon: "ğŸŒ" },
];

// ---------- CSVãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ----------

// CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
function exportToCSV(records) {
  if (!records || records.length === 0) {
    alert("ãã‚ããŒã‚ã‚Šã¾ã›ã‚“ã€‚");
    return;
  }

  const header = ["date", "task", "minutes", "count", "memo"];

  const rows = records.map((r) => {
    const dateStr = r.startedAt
      ? new Date(r.startedAt).toLocaleString("ja-JP")
      : "";
    const minutes = Math.floor((r.seconds || 0) / 60);
    const count = r.count || 0;
    const memo = r.memo || "";
    const task = r.task || "";

    return [
      `"${dateStr}"`,
      `"${task.replace(/"/g, '""')}"`,
      `"${minutes}"`,
      `"${count}"`,
      `"${memo.replace(/"/g, '""')}"`,
    ].join(",");
  });

  const csv = [header.join(","), ...rows].join("\n");

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  const today = new Date().toISOString().slice(0, 10);
  a.href = url;
  a.download = `pocopoco_history_${today}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

// CSVèª­ã¿è¾¼ã¿ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ‘ãƒ¼ã‚µï¼‰
function parseCSV(csvText) {
  const lines = csvText
    .split(/\r?\n/)
    .map((line) => line.trim())
    .filter((line) => line.length > 0);

  if (lines.length < 2) {
    throw new Error("CSVã®è¡ŒãŒãŸã‚Šã¾ã›ã‚“ã€‚");
  }

  const header = lines[0].split(",").map((h) => h.replace(/^"|"$/g, ""));

  if (
    header[0] !== "date" ||
    header[1] !== "task" ||
    header[2] !== "minutes" ||
    header[3] !== "count" ||
    header[4] !== "memo"
  ) {
    throw new Error("CSVã®ãƒ˜ãƒƒãƒ€ãƒ¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚");
  }

  const records = [];

  for (let i = 1; i < lines.length; i++) {
    const rawCells = lines[i].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);
    const cells = rawCells.map((c) => c.replace(/^"|"$/g, ""));

    const [dateStr, task, minutesStr, countStr, memo] = cells;

    const startedDate = new Date(dateStr);
    if (isNaN(startedDate.getTime())) {
      console.warn("æ—¥ä»˜ãŒãƒ‘ãƒ¼ã‚¹ã§ãã¾ã›ã‚“:", dateStr);
      continue;
    }

    const seconds = parseInt(minutesStr, 10) * 60 || 0;
    const count = parseInt(countStr, 10) || 0;

    records.push({
      task: task || "",
      seconds,
      count,
      memo: memo || "",
      startedAt: startedDate.toISOString(),
    });
  }

  return records;
}

// é‡è¤‡ã‚’é¿ã‘ãªãŒã‚‰å±¥æ­´ã‚’ãƒãƒ¼ã‚¸
function mergeHistory(oldArr, newArr) {
  const result = [...oldArr];

  for (const rec of newArr) {
    const exists = result.some(
      (r) =>
        r.startedAt === rec.startedAt &&
        r.task === rec.task &&
        (r.seconds || 0) === (rec.seconds || 0) &&
        (r.count || 0) === (rec.count || 0)
    );
    if (!exists) {
      result.push(rec);
    }
  }

  return result;
}

// -------------------------------------------
// ãƒšãƒ¼ã‚¸æœ¬ä½“
// -------------------------------------------

export default function SettingsPage() {
  // è¡¨ç¤ºè¨€èª
  const [lang, setLang] = useState("jp");

  // è¦ªã‚³ãƒ¼ãƒ‰
  const [parentCode, setParentCode] = useState("");

  // ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆç™ºè¡¨ä¼šãªã©ï¼‰
  const [eventTitle, setEventTitle] = useState("");
  const [eventDate, setEventDate] = useState("");

  // èª•ç”Ÿæ—¥
  const [birthday, setBirthday] = useState("");

  // å±¥æ­´ãƒ‡ãƒ¼ã‚¿ï¼ˆCSVå…¥å‡ºåŠ›ç”¨ï¼‰
  const [records, setRecords] = useState([]);

  // ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼‰
  const [tasks, setTasks] = useState([]);

  // æ–°è¦ã‚¿ã‚¹ã‚¯ç”¨ã®å…¥åŠ›æ¬„
  const [newTaskLabel, setNewTaskLabel] = useState("");
  const [newTaskIcon, setNewTaskIcon] = useState("");

  // UIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  const [statusMsg, setStatusMsg] = useState("");

  // CSVå–ã‚Šè¾¼ã¿ç”¨
  const fileInputRef = useRef(null);

  // åˆæœŸãƒ­ãƒ¼ãƒ‰
  useEffect(() => {
    try {
      // è¨€èª
      const savedLang = window.localStorage.getItem("pocopoco_lang");
      if (
        savedLang === "hiragana" ||
        savedLang === "jp" ||
        savedLang === "en"
      ) {
        setLang(savedLang);
      }

      // è¦ªã‚³ãƒ¼ãƒ‰
      const savedCode = window.localStorage.getItem("pocopoco_parentCode");
      if (savedCode) {
        setParentCode(savedCode);
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±
      const rawEvent = window.localStorage.getItem("pocopoco_event");
      if (rawEvent) {
        try {
          const evt = JSON.parse(rawEvent);
          if (evt && typeof evt === "object") {
            setEventTitle(evt.title || "");
            setEventDate(evt.date || "");
          }
        } catch (e) {
          console.warn("ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã®JSON parseã«å¤±æ•—ã—ã¾ã—ãŸ", e);
        }
      }

      // èª•ç”Ÿæ—¥
      const savedBirthday = window.localStorage.getItem("pocopoco_birthday");
      if (savedBirthday) {
        setBirthday(savedBirthday);
      }

      // å±¥æ­´
      const rawHistory = window.localStorage.getItem("pocopoco_history");
      if (rawHistory) {
        const parsed = JSON.parse(rawHistory);
        if (Array.isArray(parsed)) {
          setRecords(parsed);
        }
      }

      // ã‚¿ã‚¹ã‚¯ä¸€è¦§
      const rawTasks = window.localStorage.getItem("pocopoco_tasks");
      if (rawTasks) {
        try {
          const parsedTasks = JSON.parse(rawTasks);
          if (Array.isArray(parsedTasks) && parsedTasks.length > 0) {
            setTasks(parsedTasks);
          } else {
            // ç©ºé…åˆ— or å¤‰ãªå€¤ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŠ•å…¥
            setTasks(DEFAULT_TASKS);
            window.localStorage.setItem(
              "pocopoco_tasks",
              JSON.stringify(DEFAULT_TASKS)
            );
          }
        } catch (e) {
          console.warn("pocopoco_tasks parseå¤±æ•—ã€‚åˆæœŸå€¤ã‚’æ¡ç”¨ã—ã¾ã™", e);
          setTasks(DEFAULT_TASKS);
          window.localStorage.setItem(
            "pocopoco_tasks",
            JSON.stringify(DEFAULT_TASKS)
          );
        }
      } else {
        // ã¾ã ä¸€åº¦ã‚‚ä¿å­˜ã•ã‚Œã¦ã„ãªã„å ´åˆã¯åˆæœŸã‚»ãƒƒãƒˆ
        setTasks(DEFAULT_TASKS);
        window.localStorage.setItem(
          "pocopoco_tasks",
          JSON.stringify(DEFAULT_TASKS)
        );
      }
    } catch (e) {
      console.error("settings load error", e);
    }
  }, []);

  // -------- ä¿å­˜ç³»ãƒãƒ³ãƒ‰ãƒ© --------

  function handleSaveLang() {
    window.localStorage.setItem("pocopoco_lang", lang);
    setStatusMsg("ã²ã‚‡ã†ã˜ã’ã‚“ã”ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
  }

  function handleSaveParentCode() {
    if (!/^[0-9]{4}$/.test(parentCode)) {
      setStatusMsg("4ã‘ãŸã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }
    window.localStorage.setItem("pocopoco_parentCode", parentCode);
    setStatusMsg("ã²ã¿ã¤ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
  }

  function handleSaveEvent() {
    const data = {
      title: eventTitle,
      date: eventDate,
    };
    window.localStorage.setItem("pocopoco_event", JSON.stringify(data));
    setStatusMsg("ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
  }

  function handleSaveBirthday() {
    window.localStorage.setItem("pocopoco_birthday", birthday);
    setStatusMsg("ãŠãŸã‚“ã˜ã‚‡ã†ã³ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
  }

  // ã‚¿ã‚¹ã‚¯ã‚’localStorageã«åæ˜ 
  function persistTasks(nextTasks) {
    setTasks(nextTasks);
    window.localStorage.setItem("pocopoco_tasks", JSON.stringify(nextTasks));
  }

  function handleAddTask() {
    const label = newTaskLabel.trim();
    const icon = newTaskIcon.trim();

    if (!label) {
      setStatusMsg("ã‚¿ã‚¹ã‚¯ã‚ã„ ã‚’ã„ã‚Œã¦ãã ã•ã„ã€‚");
      return;
    }
    if (!icon) {
      setStatusMsg("ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãˆã‚‚ã˜ãªã©ï¼‰ã‚’ã„ã‚Œã¦ãã ã•ã„ã€‚");
      return;
    }

    const next = [...tasks, { label, icon }];
    persistTasks(next);

    setNewTaskLabel("");
    setNewTaskIcon("");
    setStatusMsg(`ã€Œ${label}ã€ã‚’ ã¤ã„ã‹ã—ã¾ã—ãŸã€‚`);
  }

  function handleDeleteTask(idx) {
    const ok = window.confirm(
      "ã“ã®ã‚¿ã‚¹ã‚¯ã‚’ãƒªã‚¹ãƒˆã‹ã‚‰ ã‘ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã“ã‚Œã¾ã§ã®ãã‚ãã¯ ã®ã“ã‚Šã¾ã™ï¼‰"
    );
    if (!ok) return;

    const next = tasks.filter((_, i) => i !== idx);
    persistTasks(next);

    setStatusMsg("ã‚¿ã‚¹ã‚¯ã‚’ ã‘ã—ã¾ã—ãŸã€‚");
  }

  // -------- CSVå…¥å‡ºåŠ› --------

  function handleExportCSV() {
    try {
      exportToCSV(records);
      setStatusMsg("CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚");
    } catch (e) {
      console.error("export error", e);
      setStatusMsg("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
    }
  }

  function handleImportClick() {
    if (fileInputRef.current) {
      fileInputRef.current.value = "";
      fileInputRef.current.click();
    }
  }

  function handleFileSelected(e) {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (loadEvent) => {
      try {
        const text = loadEvent.target.result;
        const importedRecords = parseCSV(text);

        const merged = mergeHistory(records, importedRecords);

        window.localStorage.setItem(
          "pocopoco_history",
          JSON.stringify(merged)
        );

        setRecords(merged);

        setStatusMsg(`CSVã‹ã‚‰${importedRecords.length}ä»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚`);
      } catch (err) {
        console.error("import error", err);
        setStatusMsg(
          "CSVã®ã‚ˆã¿ã“ã¿ã« ã—ã£ã±ã„ã—ã¾ã—ãŸã€‚ ã‘ã„ã—ãã‚’ ã‹ãã«ã‚“ã—ã¦ãã ã•ã„ã€‚"
        );
      }
    };
    reader.readAsText(file, "utf-8");
  }

  // -------------------------------------------
  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  // -------------------------------------------

  return (
    <main
      style={{
        fontFamily: "system-ui, sans-serif",
        padding: "24px 16px 80px",
        maxWidth: "480px",
        margin: "0 auto",
      }}
    >
      <h1
        style={{
          fontSize: "20px",
          fontWeight: "600",
          marginBottom: "8px",
          color: "#4a148c",
        }}
      >
        è¨­å®š
      </h1>

      <p
        style={{
          fontSize: "12px",
          lineHeight: 1.4,
          color: "#666",
          marginBottom: "16px",
        }}
      >
        ãŠã†ã¡ã®ã²ã¨ ãŒ ã¤ã‹ã† ã›ã£ã¦ã„ã§ã™ã€‚ã“ã©ã‚‚ã¯ ã•ã‚ã‚‰ãªã„ã§ã­ã€‚
      </p>

      {/* è¡¨ç¤ºè¨€èª */}
      <section style={cardStyle}>
        <div style={sectionTitleStyle}>ã²ã‚‡ã†ã˜ã’ã‚“ã” / Language</div>

        <div style={sectionDescStyle}>
          ã“ã©ã‚‚ã«ã¯ ã²ã‚‰ãŒãªã€
          ãŠã¨ãªã«ã¯ ãµã¤ã†ã® ã«ã»ã‚“ã”ã€
          ãã‚‡ã†ã—ãƒ»å…ˆç”Ÿã«ã¯ ãˆã„ã” ãªã© ãˆã‚‰ã¹ã¾ã™ã€‚
        </div>

        <select
          value={lang}
          onChange={(e) => setLang(e.target.value)}
          style={inputStyle}
        >
          <option value="hiragana">ã«ã»ã‚“ã”ï¼ˆã²ã‚‰ãŒãªï¼‰</option>
          <option value="jp">ã«ã»ã‚“ã”ï¼ˆãµã¤ã†ï¼‰</option>
          <option value="en">English</option>
        </select>

        <button style={purpleButtonStyle} onClick={handleSaveLang}>
          è¡¨ç¤ºè¨€èªã‚’ä¿å­˜
        </button>
      </section>

      {/* è¦ªã‚³ãƒ¼ãƒ‰ */}
      <section style={cardStyle}>
        <div style={sectionTitleStyle}>ãŠã¨ãªã® ã²ã¿ã¤ã‚³ãƒ¼ãƒ‰ï¼ˆ4ã‘ãŸï¼‰</div>

        <div style={sectionDescStyle}>
          ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ ã—ã£ã¦ã„ã‚‹ã²ã¨ ã ã‘ãŒ
          ã€Œã‚Œã‚“ã—ã‚…ã†ã®ãã‚ãã€ã‚’ ã¸ã‚“ã—ã‚…ã†ãƒ»ã•ãã˜ã‚‡ ã§ãã¾ã™ã€‚
        </div>

        <input
          type="password"
          value={parentCode}
          onChange={(e) => setParentCode(e.target.value)}
          placeholder="1234"
          style={{
            ...inputStyle,
            fontSize: "16px",
            letterSpacing: "0.3em",
            marginBottom: "12px",
          }}
        />

        <button style={gradientButtonStyle} onClick={handleSaveParentCode}>
          ã²ã¿ã¤ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜
        </button>
      </section>

      {/* ã‚¿ã‚¹ã‚¯ã®ã›ã£ã¦ã„ */}
      <section style={cardStyle}>
        <div style={sectionHeaderRowStyle}>
          <div style={sectionTitleStyle}>ã‚¿ã‚¹ã‚¯ã®ã›ã£ã¦ã„</div>
          <div style={adultBadgeStyle}>ãŠã¨ãªå°‚ç”¨</div>
        </div>

        <div style={sectionDescStyle}>
          ãƒ›ãƒ¼ãƒ ã« ãªã‚‰ã¶ ãƒœã‚¿ãƒ³ã‚’ ã¤ãã‚Šã¾ã™ã€‚
          ãˆã‚‚ã˜ ã¨ ãªã¾ãˆ ã‚’ ã„ã‚Œã¦ ã¤ã„ã‹ã§ãã¾ã™ã€‚
          ã„ã‚‰ãªã„ã‚¿ã‚¹ã‚¯ã¯ã€Œã‘ã™ã€ã§ã²ã‚‡ã†ã˜ã‹ã‚‰ ã¯ãšã›ã¾ã™ã€‚
          ï¼ˆãã‚ããƒ‡ãƒ¼ã‚¿ã¯ ã®ã“ã‚Šã¾ã™ï¼‰
        </div>

        {/* ã„ã¾ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ä¸€è¦§ */}
        <div
          style={{
            marginBottom: "16px",
            border: "1px solid #eee",
            borderRadius: "8px",
            padding: "8px 12px",
            maxHeight: "160px",
            overflowY: "auto",
            backgroundColor: "#fafafa",
          }}
        >
          {tasks.length === 0 ? (
            <div
              style={{
                fontSize: "12px",
                color: "#888",
                textAlign: "center",
                padding: "12px 0",
              }}
            >
              ï¼ˆã‚¿ã‚¹ã‚¯ã¯ ã¾ã  ã‚ã‚Šã¾ã›ã‚“ï¼‰
            </div>
          ) : (
            tasks.map((task, idx) => (
              <div
                key={idx}
                style={{
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "space-between",
                  fontSize: "14px",
                  padding: "6px 0",
                  borderBottom:
                    idx === tasks.length - 1
                      ? "none"
                      : "1px solid rgba(0,0,0,0.05)",
                }}
              >
                <div
                  style={{
                    display: "flex",
                    alignItems: "center",
                    gap: "8px",
                    lineHeight: 1.3,
                  }}
                >
                  <span style={{ fontSize: "20px" }}>{task.icon}</span>
                  <span style={{ fontWeight: 600, color: "#333" }}>
                    {task.label}
                  </span>
                </div>

                <button
                  onClick={() => handleDeleteTask(idx)}
                  style={{
                    backgroundColor: "#fff",
                    border: "1px solid #ccc",
                    borderRadius: "8px",
                    padding: "6px 10px",
                    fontSize: "12px",
                    lineHeight: 1.2,
                    color: "#a00",
                    minWidth: "48px",
                  }}
                >
                  ã‘ã™
                </button>
              </div>
            ))
          )}
        </div>

        {/* ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
        <div
          style={{
            fontSize: "13px",
            fontWeight: 600,
            marginBottom: "8px",
          }}
        >
          ã‚¿ã‚¹ã‚¯ã‚’ã¤ã„ã‹
        </div>

        <label
          style={{
            display: "block",
            fontSize: "12px",
            fontWeight: "600",
            marginBottom: "4px",
          }}
        >
          ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãˆã‚‚ã˜ï¼‰
        </label>
        <input
          type="text"
          value={newTaskIcon}
          onChange={(e) => setNewTaskIcon(e.target.value)}
          placeholder="ğŸ» ã‚„ ğŸ“– ãªã©"
          style={{ ...inputStyle, marginBottom: "12px" }}
        />

        <label
          style={{
            display: "block",
            fontSize: "12px",
            fontWeight: "600",
            marginBottom: "4px",
          }}
        >
          ã‚¿ã‚¹ã‚¯ã‚ã„
        </label>
        <input
          type="text"
          value={newTaskLabel}
          onChange={(e) => setNewTaskLabel(e.target.value)}
          placeholder="ãƒã‚¤ã‚ªãƒªãƒ³ / ã•ã‚“ã™ã† / ãˆã„ã” ãªã©"
          style={{ ...inputStyle, marginBottom: "12px" }}
        />

        <button style={purpleButtonStyle} onClick={handleAddTask}>
          ã‚¿ã‚¹ã‚¯ã‚’ã¤ã„ã‹
        </button>
      </section>

      {/* ã‚¤ãƒ™ãƒ³ãƒˆ */}
      <section style={cardStyle}>
        <div style={sectionTitleStyle}>ã‚¤ãƒ™ãƒ³ãƒˆ / æœ¬ç•ªã®æ—¥</div>

        <div style={sectionDescStyle}>
          ã¯ã£ã´ã‚‡ã†ã‹ã„ãƒ»ã‚³ãƒ³ã‚¯ãƒ¼ãƒ« ãªã©ã€
          ã¤ãã® ãŸã„ã›ã¤ãªæ—¥ ã‚’ 1ã¤ ã ã‘ ãã‚ãã—ã¾ã™ã€‚
          ãƒ›ãƒ¼ãƒ ã«ã€Œâ—¯â—¯ã¾ã§ ã‚ã¨â—¯æ—¥ã€ã¨å‡ºã™ç”¨ã§ã™ã€‚
        </div>

        <label style={labelStyle}>ã‚¤ãƒ™ãƒ³ãƒˆå</label>
        <input
          type="text"
          value={eventTitle}
          onChange={(e) => setEventTitle(e.target.value)}
          placeholder="ã¯ã£ã´ã‚‡ã†ã‹ã„ / ã‚³ãƒ³ã‚¯ãƒ¼ãƒ«æœ¬é¸ ãªã©"
          style={{ ...inputStyle, marginBottom: "12px" }}
        />

        <label style={labelStyle}>æ—¥ä»˜</label>
        <input
          type="date"
          value={eventDate}
          onChange={(e) => setEventDate(e.target.value)}
          style={{ ...inputStyle, marginBottom: "12px" }}
        />

        <button style={deepPurpleButtonStyle} onClick={handleSaveEvent}>
          ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜
        </button>
      </section>

      {/* ãŠãŸã‚“ã˜ã‚‡ã†ã³ */}
      <section style={cardStyle}>
        <div style={sectionTitleStyle}>ãŠãŸã‚“ã˜ã‚‡ã†ã³</div>

        <div style={sectionDescStyle}>
          ã“ã®æ—¥ã« ã‚¢ãƒ—ãƒªã‚’ã²ã‚‰ãã¨
          ã€ŒğŸ‚ãŠãŸã‚“ã˜ã‚‡ã†ã³ãŠã‚ã§ã¨ã†ï¼ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’
          ã“ã©ã‚‚ã‚€ã‘ã« ã²ã‚‡ã†ã˜ ã—ã¾ã™ã€‚
        </div>

        <label style={labelStyle}>æ—¥ä»˜</label>
        <input
          type="date"
          value={birthday}
          onChange={(e) => setBirthday(e.target.value)}
          style={{ ...inputStyle, marginBottom: "12px" }}
        />

        <button style={pinkButtonStyle} onClick={handleSaveBirthday}>
          ãŠãŸã‚“ã˜ã‚‡ã†ã³ã‚’ä¿å­˜
        </button>
      </section>

      {/* ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— / ã²ã£ã“ã— */}
      <section
        style={{
          border: "1px solid #ddd",
          borderRadius: "12px",
          padding: "16px",
          marginBottom: "24px",
          backgroundColor: "#f9f9ff",
          boxShadow: "0 2px 4px rgba(0,0,0,0.03)",
        }}
      >
        <div style={sectionHeaderRowStyle}>
          <div style={sectionTitleStyle}>ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— / ã²ã£ã“ã—</div>
          <div style={adultBadgeStyle}>ãŠã¨ãªå°‚ç”¨</div>
        </div>

        <div style={sectionDescStyle}>
          ãã‚ãã‚’ ã»ã‹ã® ãã‹ã„ ã« ã†ã¤ã™ ã¨ã ã‚„ã€
          ã¾ã„ã«ã¡ ã® ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚ˆã†ã§ã™ã€‚
        </div>

        <button style={purpleButtonStyle} onClick={handleExportCSV}>
          ğŸ“¤ ãã‚ãã‚’CSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>

        <button style={greenButtonStyle} onClick={handleImportClick}>
          ğŸ“¥ CSVã‹ã‚‰ ã‚ˆã¿ã“ã‚€
        </button>

        <div
          style={{
            fontSize: "11px",
            color: "#444",
            lineHeight: 1.4,
            marginTop: "8px",
          }}
        >
          â€» ã¾ãˆã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ pocopoco_history_â—¯â—¯â—¯.csv ã‚’
          ãˆã‚‰ã‚“ã§ãã ã•ã„ã€‚
        </div>

        <input
          ref={fileInputRef}
          type="file"
          accept=".csv,text/csv"
          style={{ display: "none" }}
          onChange={handleFileSelected}
        />
      </section>

      {/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */}
      {statusMsg && (
        <div
          style={{
            textAlign: "center",
            fontSize: "13px",
            lineHeight: 1.4,
            color: "#4a148c",
            backgroundColor: "#f5ecff",
            border: "1px solid #e0ccff",
            borderRadius: "8px",
            padding: "8px 12px",
          }}
        >
          {statusMsg}
        </div>
      )}

      {/* æˆ»ã‚‹ */}
      <div style={{ textAlign: "center", marginTop: "24px" }}>
        <button
          onClick={() => {
            window.location.href = "/";
          }}
          style={{
            background: "none",
            border: "none",
            color: "#666",
            fontSize: "14px",
            textDecoration: "underline",
            padding: "8px 12px",
          }}
        >
          â† ãƒ›ãƒ¼ãƒ ã«ã‚‚ã©ã‚‹
        </button>
      </div>
    </main>
  );
}

// -------------------------------------------
// ã‚¹ã‚¿ã‚¤ãƒ«å…±é€š
// -------------------------------------------

const cardStyle = {
  border: "1px solid #ddd",
  borderRadius: "12px",
  padding: "16px",
  marginBottom: "24px",
  backgroundColor: "#fff",
  boxShadow: "0 2px 4px rgba(0,0,0,0.03)",
};

const sectionTitleStyle = {
  fontSize: "15px",
  fontWeight: "600",
  marginBottom: "8px",
};

const sectionHeaderRowStyle = {
  display: "flex",
  flexWrap: "wrap",
  alignItems: "center",
  gap: "6px",
  marginBottom: "8px",
};

const sectionDescStyle = {
  fontSize: "12px",
  color: "#888",
  lineHeight: 1.4,
  marginBottom: "12px",
  whiteSpace: "pre-wrap",
};

const labelStyle = {
  display: "block",
  fontSize: "13px",
  fontWeight: "600",
  marginBottom: "4px",
};

const inputStyle = {
  width: "100%",
  border: "1px solid #bbb",
  borderRadius: "8px",
  fontSize: "14px",
  padding: "8px 10px",
  backgroundColor: "#fff",
};

const adultBadgeStyle = {
  backgroundColor: "#fff8e1",
  color: "#a15a00",
  fontSize: "11px",
  fontWeight: "600",
  border: "1px solid #ffe0a1",
  borderRadius: "6px",
  padding: "2px 6px",
  lineHeight: 1.3,
};

const purpleButtonStyle = {
  width: "100%",
  backgroundColor: "#4a148c",
  color: "#fff",
  border: "none",
  borderRadius: "10px",
  fontSize: "15px",
  fontWeight: "600",
  padding: "12px",
  boxShadow: "0 4px 8px rgba(0,0,0,0.15)",
  marginBottom: "12px",
  textAlign: "center",
};

const deepPurpleButtonStyle = {
  width: "100%",
  backgroundColor: "#6a1b9a",
  color: "#fff",
  border: "none",
  borderRadius: "10px",
  fontSize: "15px",
  fontWeight: "600",
  padding: "12px",
  boxShadow: "0 4px 8px rgba(0,0,0,0.15)",
};

const pinkButtonStyle = {
  width: "100%",
  backgroundColor: "#d81b60",
  color: "#fff",
  border: "none",
  borderRadius: "10px",
  fontSize: "15px",
  fontWeight: "600",
  padding: "12px",
  boxShadow: "0 4px 8px rgba(0,0,0,0.15)",
};

const gradientButtonStyle = {
  width: "100%",
  background:
    "linear-gradient(90deg, rgb(204,0,255), rgb(255,102,153))",
  color: "#fff",
  border: "none",
  borderRadius: "10px",
  fontSize: "15px",
  fontWeight: "600",
  padding: "12px",
  boxShadow: "0 4px 8px rgba(0,0,0,0.15)",
};

const greenButtonStyle = {
  width: "100%",
  backgroundColor: "#00695c",
  color: "#fff",
  border: "none",
  borderRadius: "10px",
  fontSize: "15px",
  fontWeight: "600",
  padding: "12px",
  boxShadow: "0 4px 8px rgba(0,0,0,0.15)",
  textAlign: "center",
};
